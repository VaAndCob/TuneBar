# TuneBar Firmware

This directory contains the source code for the TuneBar project. The firmware is developed using **pioArduino**, a high-performance branch of the Espressif 32 platform for PlatformIO.

## Development Environment

*   **IDE**: Visual Studio Code
*   **Extension**: PlatformIO IDE
*   **Core/Framework**: pioArduino (Arduino Framework for ESP32)

## Project Structure

The project follows the standard PlatformIO structure:

*   `src/`: Contains the main source code (`main.cpp`, logic handlers).
    *   `src/ui/`: User Interface code generated by SquareLine Studio.
    *   `src/es8311/`: Custom driver implementation for the ES8311 audio codec.
*   `data/`: Filesystem data (contains the example `station.csv`).
*   `lib/`: Project-specific private libraries.
*   `include/`: Global header files.
*   `platformio.ini`: Project configuration file (board settings, build flags, library dependencies).

## Library References

The project relies on the following key libraries, managed via `platformio.ini`:

*   **LVGL**: (Light and Versatile Graphics Library) Used for the graphical user interface.
*   **ArduinoJson**: Used for parsing JSON data from Weather and Air Quality APIs.
*   **Audio**: (or specific I2S library) Handles audio stream decoding and playback.
*   **WiFi & HTTPClient**: Standard ESP32 libraries for network connectivity.

## Getting Started

1.  **Install Tools**: Install VS Code and the PlatformIO extension.
2.  **Open Project**: Open this `sketch` folder within VS Code.
3.  **Install Dependencies**: PlatformIO will automatically download the libraries listed in `platformio.ini` upon the first build.
4.  **Configuration**:
    *   Verify board settings in `platformio.ini`.
    *   Update WiFi credentials and API keys in the source code (e.g., `config.h` or `main.cpp`) if hardcoded.
5.  **Build & Upload**: Connect your ESP32-S3 device and use the PlatformIO toolbar to build and upload the firmware.

## Development Notes

### UI Modification (SquareLine Studio)

If you modify the interface using SquareLine Studio:
1.  Export the project to `sketch/src/ui`.
2.  **Important**: As noted in `IMPORTANT.txt`, you must edit `sketch/src/ui/ui.c` after export. Comment out the lines related to `imgset` to prevent compilation errors:
    ```c
    //PropertyAnimation_0_user_data->imgset = (lv_img_dsc_t **)ui_imgset_;
    //PropertyAnimation_0_user_data->imgset_size = sizeof(ui_imgset_)/(sizeof(lv_img_dsc_t*));
    ```
3.  **Fonts**: To add support for other languages (e.g., Thai), copy the generated font `.c` files to `sketch/src/ui`.

4.   **UI Updates**: If updating the UI via SquareLine Studio, export the files to `src/ui/` and refer to the main project README for specific file modifications required (e.g., commenting out `imgset` in `ui.c`).